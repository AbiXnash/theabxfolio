---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";

const { title = "abx@portfolio" } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>

  <body class="flex min-h-screen flex-col antialiased text-white">
    <!-- SYSTEM BOOT -->
    <div
      id="boot"
      class="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 text-white"
    >
      <div class="boot-panel">
        <div class="boot-header">
          <span class="boot-dot red"></span>
          <span class="boot-dot yellow"></span>
          <span class="boot-dot green"></span>
          <span class="boot-title">abx.system</span>
        </div>
        <div class="boot-body">
          <p data-line class="boot-line">
            <span class="boot-tag">[ ok ]</span> loading environment
          </p>
          <p data-line class="boot-line">
            <span class="boot-tag">[ ok ]</span> initializing interface
          </p>
          <p data-line class="boot-line">
            <span class="boot-tag">[ ok ]</span> mounting modules
          </p>
          <p data-line class="boot-line">
            <span class="boot-tag">[ ok ]</span> ready
          </p>
        </div>
      </div>
    </div>

    <Header />

    <main class="flex-1">
      <slot />

    </main>

    <Footer />

    <!-- SCRIPT -->
    <script>
      import { renderHTMLElement } from "astro/runtime/server/index.js";

      /* ---------------- BOOT ---------------- */
      (() => {
        const boot = document.getElementById("boot");
        if (!boot) return;

        const prefersReducedMotion = window.matchMedia(
          "(prefers-reduced-motion: reduce)",
        ).matches;

        if (sessionStorage.getItem("booted") || prefersReducedMotion) {
          boot.remove();
          return;
        }

        sessionStorage.setItem("booted", "true");

        const lines = boot.querySelectorAll("[data-line]");
        lines.forEach((line, i) =>
          setTimeout(() => line.classList.add("is-visible"), i * 220),
        );

        const total = lines.length * 220 + 700;
        setTimeout(() => {
          boot.style.transition = "opacity 320ms ease, transform 320ms ease";
          boot.style.opacity = "0";
          boot.style.transform = "translateY(-8px)";
          setTimeout(() => boot.remove(), 360);
        }, total);
      })();
    </script>
  </body>
</html>

<style>
  .boot-panel {
    width: min(420px, 90vw);
    background: rgba(8, 10, 16, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 18px;
    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);
    overflow: hidden;
  }

  .boot-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(10, 12, 20, 0.9);
  }

  .boot-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
  }

  .boot-dot.red {
    background: #ff5f57;
  }

  .boot-dot.yellow {
    background: #febc2e;
  }

  .boot-dot.green {
    background: #28c840;
  }

  .boot-title {
    margin-left: auto;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.5);
  }

  .boot-body {
    padding: 1.5rem 1.4rem;
    font-size: 0.85rem;
  }

  .boot-tag {
    color: var(--accent-strong);
  }

</style>
