---
const path = Astro.url.pathname.split("/").filter(Boolean);
const isHome = path.length === 0;
const isActive = (href) => Astro.url.pathname === href;
---

<header
  class="sticky top-0 z-50 border-b border-white/10 bg-black/30 backdrop-blur-2xl shadow-[0_12px_40px_rgba(0,0,0,0.45)]"
>
  <div
    class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3 text-xs sm:px-6 sm:text-sm"
  >
    <!-- LEFT: BACK + BRAND + BREADCRUMB -->
    <div class="flex items-center gap-2 overflow-x-auto text-[var(--accent)]">
      <!-- BACK BUTTON (non-home) -->
      {
        !isHome && (
          <button
            onclick="history.back()"
            class="text-white/40 transition hover:text-white"
            aria-label="go back"
          >
            ←
          </button>
        )
      }

      <a href="/" class="brand-link">
        <span class="brand-badge">abx@portfolio</span>
      </a>

      <span class="mx-2 shrink-0 text-white/40">:</span>
      <span class="shrink-0 text-[var(--accent-alt)]">~</span>

      <div class="flex min-w-0 items-center">
        {
          isHome ? (
            <span class="ml-2 text-white/60">/</span>
          ) : (
            path.map((segment) => (
              <span class="ml-2 whitespace-nowrap text-white/60">
                /
                <a href={`/${segment}`} class="transition hover:text-white">
                  {segment}
                </a>
              </span>
            ))
          )
        }
      </div>

      <span class="ml-2 shrink-0 animate-pulse text-white/40">▍</span>
    </div>

    <!-- CENTER: STATUS (DESKTOP ONLY) -->
    <div class="hidden items-center gap-3 text-white/40 md:flex">
      <span id="sysTime" class="tracking-widest"></span>
      <span class="text-white/20">|</span>
      <span>status: <span class="text-[var(--accent)]">online</span></span>
    </div>

    <!-- RIGHT: ACTIONS -->
    <div class="flex items-center gap-4">
      <!-- NAV (DESKTOP) -->
      <nav class="hidden items-center gap-2 text-white/60 sm:flex">
        <a
          href="/resume"
          class={`nav-link ${isActive("/resume") ? "is-active" : ""}`}
        >
          resume
        </a>
        <a
          href="/service"
          class={`nav-link ${isActive("/service") ? "is-active" : ""}`}
        >
          service
        </a>
        <a
          href="/contact"
          class={`nav-link ${isActive("/contact") ? "is-active" : ""}`}
        >
          contact
        </a>
      </nav>

      <!-- MOBILE ACTIONS -->
      <div class="relative flex items-center gap-3 sm:hidden">

        <!-- MENU -->
        <button
          id="navToggle"
          class="flex items-center gap-1 text-white/60 hover:text-white"
          aria-label="menu"
        >
          <span>ls</span>
          <span class="text-[10px] text-white/30">(menu)</span>
        </button>

        <div
          id="navMenu"
          class="absolute top-7 right-0 hidden rounded-lg border border-white/10 bg-black/90 text-xs text-white/70 backdrop-blur"
        >
          <a
            href="/resume"
            class={`block px-4 py-2 hover:bg-white/10 ${isActive("/resume") ? "text-white" : ""}`}
          >
            resume
          </a>
          <a
            href="/service"
            class={`block px-4 py-2 hover:bg-white/10 ${isActive("/service") ? "text-white" : ""}`}
          >
            service
          </a>
          <a
            href="/contact"
            class={`block px-4 py-2 hover:bg-white/10 ${isActive("/contact") ? "text-white" : ""}`}
          >
            contact
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  .brand-link {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    transition: all 160ms ease;
  }

  .brand-badge {
    padding: 0.25rem 0.7rem;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    color: var(--accent);
    letter-spacing: 0.08em;
  }

  .nav-link {
    position: relative;
    padding: 0.35rem 0.75rem;
    border-radius: 999px;
    transition: all 160ms ease;
  }

  .nav-link:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.06);
  }

  .nav-link.is-active {
    color: #0b1d13;
    background: var(--accent);
  }
</style>

<!-- HEADER SCRIPT -->
<script>
  /* ---------- SYSTEM TIME ---------- */
  const timeEl = document.getElementById("sysTime");
  if (timeEl) {
    const updateTime = () => {
      const d = new Date();
      timeEl.textContent = `[${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}:${String(d.getSeconds()).padStart(2, "0")}]`;
    };
    updateTime();
    setInterval(updateTime, 1000);
  }

  /* ---------- MOBILE MENU ---------- */
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("navToggle");
    const menu = document.getElementById("navMenu");

    toggle?.addEventListener("click", () => {
      menu.classList.toggle("hidden");
    });

    document.addEventListener("click", (e) => {
      if (!toggle.contains(e.target) && !menu.contains(e.target)) {
        menu.classList.add("hidden");
      }
    });
  });
</script>
